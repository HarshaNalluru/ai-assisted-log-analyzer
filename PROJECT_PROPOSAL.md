# AMQP Log Analyzer

## Introduction

The AMQP Log Analyzer is a web application designed to provide AI-powered insights for cross-language AMQP logs, such as those generated by Azure Service Bus and Azure Event Hubs SDKs. By leveraging Azure OpenAI, the solution enables users and systems to process large AMQP log files and receive structured, actionable summaries and details, making it easier to understand, debug, and optimize messaging workflows.

## Motivation

AMQP-based messaging systems generate extremely large and complex logs, especially in distributed and high-throughput environments. This results in slow, error-prone, and often infeasible manual analysis, increasing operational costs and delaying resolution of ICMs and user issues. Past ICMs, user issues and stress tests have highlighted the growing scale and complexity of AMQP logs, with files often exceeding hundreds of thousands of lines. Manual analysis is not sustainable, developers have spent hours or days per incident, delaying root cause analysis and impacting customer experience.

Advances in AI and the availability of scalable models (e.g., GPT-4.1) now make automated, high-quality log analysis feasible and cost-effective. The AMQP Log Analyzer leverages AI to automate the extraction of actionable insights, enabling teams to quickly diagnose issues, reduce investigation time, and improve operational efficiency. This solution directly enhances developer productivity for teams working with such logs, and helps us meet SLAs and deliver a better customer experience.

## Project Goals

- Provide a backend library (in genAIScript) for AMQP log analysis, designed for integration in multiple environments (CLI, UI(react app), CI, MCP, etc.).
- Enable users and systems to analyze large AMQP log files efficiently.
- Support AI-generated summaries and detailed insights for each logical chunk of the log.
- Investigate higher-level APIs to process the logs efficiently, avoiding manual chunking.
- Offer both CLI tooling and an optional interactive UI for exploring log data.
- Support natural language queries about the logs and insights.
- Make the architecture extensible for integration with Azure SDK MCP server, fault-injector, and other tools.

## Use Cases

- **Developer CLI:** Analyze logs locally or in CI pipelines, outputting structured summaries and error reports.
- **Automated CI Analysis:** Automatically generate and dump log analysis for stress test runs, reducing the time taken in a manual review.
- **Azure SDK(internal) MCP Integration:** Provide in-context log insights and troubleshooting within the MCP server/VS Code.
- **UI(react app) for Exploration:** Rich, interactive UI for deep-dive analysis and demo purposes.

## Current Capabilities

- React-based UI for interactive exploration. Upload and view raw AMQP log files in the browser.
- Log file is split into manageable chunks and sent to Azure OpenAI for analysis.
- Each chunk is summarized with its purpose and key events/errors in a structured format.
- Expandable UI for exploring chunk and subchunk insights.
- Query panel for asking questions about the logs in natural language.
- Dynamic, real-time rendering as logs are analyzed.
- Support for multiple log formats and comparison of logs from different SDKs/languages.

## Workflow

- The current prototype is built with React and TypeScript, but the core logic will be migrated to a backend library.
- Uses Azure OpenAI via `@azure-rest/ai-inference` for chunk analysis.
- Log chunking is optimized for API limits (e.g., 32K/1M token models).
- Insights are rendered in a tree structure for easy navigation.
- CLI and UI both consume the same backend library for consistency.
- Architecture is extensible to other log types or protocols in the future.
  ![alt text](image-1.png)

## Benefits and Impact

- Reduces incident analysis time for large AMQP logs by 50% or more, saving developer hours and reducing downtime.
- Makes AMQP logs accessible to non-experts via natural language queries, broadening the tool's impact across support, SRE, and engineering teams, and can potentially be offered to customers in the future.
- Enables rapid feedback and iteration during incident investigations, improving customer satisfaction and helping meet SLAs.
- Supports cross-team collaboration by sharing structured insights, and can be adopted across language teams for broader organizational impact.
- Frees engineering resources for higher-value work, improving overall productivity and reducing operational costs.
- Extensible architecture allows integration with MCP, fault-injector, and other tools, maximizing long-term value.

## Interest so far

- Team feedback highlighted excitement about valuable insights from prompt and chunk size tweaks.
- Shared with **Richard, Swathi, Jeremy, and Deya**; all found the tool promising for real-world AMQP logs. From a test log that Swathi shared, we were excited to see it provide actionable insights from simple tweaking of the prompts and chunk sizes, sneakpeek below:
  ![alt text](image.png)
- Maor showed interest in integrating with the Azure SDK MCP server for insights and automated troubleshooting without leaving VS Code.

## Architecture

```mermaid
flowchart TD
    subgraph UI[User Interface]
        U1[File Uploader]
        U2[Log Viewer]
        U3[Insight Panel]
        U4[Query Panel]
    end

    subgraph Backend[Backend & AI Services]
        B1[Log Chunker]
        B2[Prompt Engineering and AMQP protocol context]
        B3[Azure OpenAI API]
        B4[Chunk Summarizer]
        B5[Query Processor]
        B6[Azure OpenAI API]
    end

    U1 -- Uploads Log File --> B1
    B1 -- Splits Log --> B2
    B2 -- Sends Chunks & Prompts --> B3
    B3 -- Returns Summaries --> B4
    B4 -- Structured Insights --> U3
    U2 -- Displays Raw Logs --> U3
    U3 -- Shows Insights --> U4
    U4 -- User Asks Questions --> B5
    B5 -- Processes Query (AI/Heuristic) --> B6
    B6 -- Query Response --> U4
```

## Integration Vision

A single backend library, written in genAIScript, will power multiple frontends: CLI, UI, MCP, and CI automation. The design will ensure easy extensibility for future needs and seamless integration with Azure SDK tools and the fault-injector ecosystem.

## Future Enhancements / Next Steps

1. **Investigate Higher-Level APIs:** Explore and adopt higher-level APIs to further simplify log analysis and reduce the need for manual chunking.
2. **GenAI Script Integration & Automation:** Integrate with GenAI scripts to automate and customize log analysis workflows, including automatic generation of analysis for our stress test logs in CI.
3. **Smarter Chunking & Context Preservation:** Implement log markers (e.g., "azure:" suffix), overlapping windows, and advanced chunking strategies to improve context and reduce API calls.
4. **Cost Optimization:** Batch requests and leverage higher token models (e.g., GPT-4.1 1M tokens) for fewer, larger requests, minimizing API costs.
5. **Advanced Preprocessing & Correlation:** Develop preprocessing to split and tag logs more intelligently, and algorithms for correlating non-consecutive events and errors across large AMQP logs.
6. **Enhanced Cross-Language Support:** Improve comparison and correlation of logs from different SDKs/languages for unified analysis.
7. **Azure SDK MCP Integration:** Connect with Maor's MCP server for deeper Azure insights and automated troubleshooting without leaving VS Code.
8. **Multi-Frontend & Platform Support:** Enable integration with other UIs and platforms beyond the current React app, including CLI and MCP.
9. **User Experience & Visualization:** Optimize UI for very large logs, add more visualization options, and improve overall usability for AMQP log analysis.
10. **Broader Rollout & Adoption:** Pilot with more teams, collect feedback, and expand usage across the organization.

---

_Prepared: May 1, 2025_
